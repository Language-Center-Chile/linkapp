<!DOCTYPE html>
<html lang="es" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Colección Compartida - LinkApp</title>
  <link rel="icon" type="image/png" href="imagenes/logo1.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            bg: "#000000",
            surface: "#18181b",
            border: "#27272a",
            blue: "#38BDF8",
            teal: "#2DD4BF",
            text: "#E2E8F0",
            muted: "#94A3B8"
          }
        }
      }
    };
  </script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .gradient-text {
      background: linear-gradient(90deg, #38BDF8, #2DD4BF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .mesh-gradient {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -10; background-color: #000000; overflow: hidden;
    }
    .mesh-sphere {
      position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.3;
    }
    .sphere-1 { width: 400px; height: 400px; background: #38BDF8; top: -100px; right: -100px; }
    .sphere-2 { width: 500px; height: 500px; background: #2DD4BF; bottom: -150px; left: -150px; }

    .link-card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(12px);
    }
    .link-card:hover {
      border-color: rgba(56, 189, 248, 0.4);
      transform: scale(1.02);
      background-color: rgba(24, 24, 27, 0.8);
    }
    .avatar-view {
      width: 120px; height: 120px; border-radius: 50%;
      object-fit: cover; border: 4px solid #27272a;
      box-shadow: 0 0 30px rgba(56, 189, 248, 0.2);
    }
  </style>
</head>
<body class="min-h-screen bg-bg text-text flex flex-col items-center relative overflow-x-hidden">

  <div class="mesh-gradient">
    <div class="mesh-sphere sphere-1"></div>
    <div class="mesh-sphere sphere-2"></div>
  </div>

  <header class="w-full max-w-4xl px-6 h-20 flex items-center justify-center z-10">
    <div class="flex items-center gap-2 opacity-50 hover:opacity-100 transition-opacity">
      <img src="imagenes/logo1.png" alt="logo" class="w-6 h-8">
      <span class="font-bold text-lg tracking-tighter text-white">LinkApp</span>
    </div>
  </header>

  <main class="w-full max-w-xl px-6 py-8 z-10 flex flex-col items-center">
    
    <div class="flex flex-col items-center text-center mb-12">
      <div id="ownerAvatarBox" class="relative mb-6">
           <img id="ownerAvatar" src="" class="avatar-view hidden">
           <div id="ownerFallback" class="avatar-view bg-surface flex items-center justify-center text-blue font-black text-4xl uppercase">?</div>
           <div class="absolute -bottom-2 left-1/2 -translate-x-1/2 bg-blue text-black text-[10px] font-black px-3 py-1 rounded-full uppercase tracking-widest shadow-lg">PRO</div>
      </div>
      
      <h2 id="ownerDisplay" class="text-2xl font-black text-white mb-2 tracking-tight">@usuario</h2>
      
      <div class="flex items-center gap-2 mb-8">
        <span class="px-3 py-1 bg-blue/10 text-blue text-[10px] font-bold uppercase tracking-widest rounded-full border border-blue/20">Colección Pública</span>
      </div>

      <h1 id="folderTitle" class="text-4xl md:text-5xl font-black tracking-tighter text-white mb-4 leading-none">Cargando...</h1>
      
      <p id="linkCount" class="text-sm text-muted font-medium uppercase tracking-[0.2em]">0 ENLACES DISPONIBLES</p>
    </div>

    <div id="linksContainer" class="w-full space-y-4"></div>

    <div class="mt-20 w-full p-8 border border-border rounded-[2.5rem] bg-surface/30 backdrop-blur-xl text-center">
      <p class="text-muted text-xs mb-6 uppercase font-black tracking-widest">¿Quieres una página como esta?</p>
      <a href="index.html" class="inline-block px-8 py-4 bg-white text-black font-black rounded-2xl hover:scale-105 transition-all text-xs uppercase tracking-widest">
        Crear mi LinkApp
      </a>
    </div>
  </main>

  <footer class="mt-auto py-12 opacity-20 text-center w-full">
    <p class="text-[9px] font-black tracking-[0.4em] uppercase">© 2026 LinkApp Digital Environment</p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const SUPABASE_URL = 'https://ioekbpgxywkvmxvfzblz.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvZWticGd4eXdrdm14dmZ6Ymx6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwMjYzMDEsImV4cCI6MjA4NTYwMjMwMX0.of00FGlEr8tLpyXkWk0ZuiKhiYsjenA9YPHUfvOGYOs';
      const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      const params = new URLSearchParams(window.location.search);
      const dataEncoded = params.get('data');

      if (!dataEncoded) {
        document.getElementById('folderTitle').textContent = "Enlace inválido";
        return;
      }

      try {
        // Decodificación segura
        const decodedData = decodeURIComponent(escape(atob(dataEncoded)));
        const data = JSON.parse(decodedData);

        // Mapeo corregido (n=nombre, u=usuario, l=links, id=userId)
        document.getElementById('folderTitle').textContent = data.n || "Sin nombre";
        document.getElementById('ownerDisplay').textContent = `@${data.u || 'usuario'}`;
        document.getElementById('linkCount').textContent = `${(data.l || []).length} ENLACES DISPONIBLES`;

        // Cargar Avatar desde Supabase usando el ID enviado
        if (data.id) {
          const { data: profile } = await _supabase
            .from('profiles')
            .select('avatar_url')
            .eq('id', data.id)
            .single();

          if (profile && profile.avatar_url) {
            const img = document.getElementById('ownerAvatar');
            img.src = profile.avatar_url;
            img.classList.remove('hidden');
            document.getElementById('ownerFallback').classList.add('hidden');
          } else {
            document.getElementById('ownerFallback').textContent = data.u.charAt(0).toUpperCase();
          }
        } else {
          document.getElementById('ownerFallback').textContent = data.u.charAt(0).toUpperCase();
        }

        // Renderizar Links
        const container = document.getElementById('linksContainer');
        if (!data.l || data.l.length === 0) {
          container.innerHTML = `<p class="text-center text-muted py-10">No hay enlaces en esta colección.</p>`;
        } else {
          container.innerHTML = data.l.map(link => {
            const url = link.url;
            const tag = link.tag || '';
            const displayUrl = url.replace(/^https?:\/\//, '').split('/')[0];
            
            return `
              <a href="${url}" target="_blank" class="link-card flex items-center justify-between p-5 bg-surface/60 border border-border rounded-2xl group w-full text-left">
                <div class="overflow-hidden">
                  <h3 class="text-md font-bold text-white group-hover:text-blue transition-colors truncate">${tag || displayUrl}</h3>
                  <p class="text-[10px] text-muted truncate opacity-60">${displayUrl}</p>
                </div>
                <div class="flex-shrink-0 ml-4">
                  <div class="w-8 h-8 flex items-center justify-center rounded-full bg-white/5 group-hover:bg-blue/20 transition-all">
                    <span class="text-blue text-sm group-hover:translate-x-0.5 transition-transform">→</span>
                  </div>
                </div>
              </a>`;
          }).join('');
        }
      } catch (e) {
        console.error("Error:", e);
        document.getElementById('folderTitle').textContent = "Error de carga";
      }
    });
  </script>
</body>
</html>