<!DOCTYPE html>
<html lang="es" class="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestor LinkApp</title>
  <link rel="icon" type="image/png" href="logo1.png">
  <link rel="stylesheet" href="estilos.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <div class="bg-gif"></div>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            bg: "#000000",
            surface: "#18181b",
            border: "#27272a",
            blue: "#38BDF8",
            text: "#E2E8F0",
            muted: "#94A3B8"
          }
        }
      }
    };

    if (localStorage.getItem('isLoggedIn') !== 'true') {
      window.location.href = 'login.html';
    }
  </script>

  <style>
    .hidden { display: none; }
  </style>
</head>

<body class="min-h-screen flex flex-col bg-bg text-text">

<header class="border-b border-border sticky top-0 bg-bg z-50">
  <div class="w-full px-6 h-20 flex items-center">
    
    <img src="logo1.png" alt="logo" class="w-12 h-14">

    <div class="ml-auto flex items-center gap-4 relative">
      
      <div class="text-right">
        <p id="userNicknameDisplay" class="text-lg font-bold text-white leading-none">Cargando...</p>
        <button onclick="logout()" class="text-[10px] text-red-400 hover:underline uppercase tracking-widest mt-1">
          Cerrar SesiÃ³n
        </button>
      </div>

      <!-- AVATAR + MENU -->
      <div class="relative">
        <button id="userMenuButton" onclick="toggleUserMenu()" 
          class="w-14 h-14 rounded-full border-2 border-border bg-surface overflow-hidden shadow-[0_0_15px_rgba(56,189,248,0.2)]">
          
          <img id="userAvatarDisplay" src="" alt="Perfil"
            class="w-full h-full object-cover hidden">
          
          <div id="avatarFallback"
            class="w-full h-full flex items-center justify-center bg-blue/10 text-blue text-xl font-bold">
            ?
          </div>
        </button>

        <div id="userDropdown"
          class="hidden absolute right-0 mt-3 w-56 bg-surface border border-border rounded-xl shadow-xl overflow-hidden z-50 text-sm">

          <div class="px-4 py-3 border-b border-border">
            <p class="text-xs text-muted">Conectado como</p>
            <p id="userNicknameMenu" class="font-bold text-white truncate">Usuario</p>
          </div>

          <a href="perfil.html" class="block px-4 py-2 text-muted hover:bg-border hover:text-white transition">
  ðŸ‘¤ Personalizar perfil
</a>

          <a href="suscripcion.html" class="block px-4 py-2 text-muted hover:bg-border hover:text-white transition">
            ðŸ’³ SuscripciÃ³n
          </a>

          <button onclick="logout()" class="w-full text-left px-4 py-2 text-red-400 hover:bg-red-500/10 transition">
            ðŸšª Cerrar sesiÃ³n
          </button>
        </div>
      </div>

    </div>
  </div>
</header>

<main class="max-w-6xl mx-auto px-6 py-12 w-full">
  <div class="flex flex-col md:flex-row justify-between items-center mb-10 gap-4">
    <div>
      <h1 class="text-3xl font-bold">Mis <span class="gradient-text">Colecciones</span></h1>
      <p class="text-muted text-sm">Organiza, busca y comparte tus carpetas de enlaces.</p>
    </div>
    <button onclick="nuevaCarpeta()" class="btn btn-primary px-6 py-2">+ Crear Carpeta</button>
  </div>

  <div id="folderGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
</main>

<!-- MODAL COMPARTIR -->
<div id="shareModal" class="share-overlay hidden">
  <div class="share-box">
    <h3 class="share-title">Compartir carpeta</h3>

    <div class="share-grid">
      <button class="share-btn whatsapp" onclick="shareWhatsApp()">WhatsApp</button>
      <button class="share-btn facebook" onclick="shareFacebook()">Facebook</button>
      <button class="share-btn telegram" onclick="shareTelegram()">Telegram</button>
      <button class="share-btn copy" onclick="copyShare()">Copiar</button>
    </div>

    <button class="share-cancel" onclick="cerrarShare()">Cancelar</button>
  </div>
</div>

<script>
/* ================= USUARIO ================= */
window.addEventListener('load', function() {
  const nick = localStorage.getItem('userNickname') || 'Usuario';
  const avatar = localStorage.getItem('userAvatar');

  document.getElementById('userNicknameDisplay').textContent = nick;
  document.getElementById('userNicknameMenu').textContent = nick;

  const avatarImg = document.getElementById('userAvatarDisplay');
  const fallback = document.getElementById('avatarFallback');

  if (avatar && avatarImg && fallback) {
    avatarImg.src = avatar;
    avatarImg.classList.remove('hidden');
    fallback.classList.add('hidden');
  } else if (fallback) {
    fallback.textContent = nick.charAt(0).toUpperCase();
  }
});

function toggleUserMenu() {
  document.getElementById("userDropdown").classList.toggle("hidden");
}

window.addEventListener("click", function(e) {
  const menu = document.getElementById("userDropdown");
  const button = document.getElementById("userMenuButton");

  if (!menu.contains(e.target) && !button.contains(e.target)) {
    menu.classList.add("hidden");
  }
});

function logout() {
  localStorage.removeItem('isLoggedIn');
  window.location.href = 'login.html';
}

/* ================= SISTEMA DE CARPETAS ================= */
let carpetas = JSON.parse(localStorage.getItem('carpetas')) || [];
let textoCompartir = "";

function guardarYRenderizar() {
  localStorage.setItem('carpetas', JSON.stringify(carpetas));
  renderCarpetas();
}

function nuevaCarpeta() {
  const n = prompt("Nombre de la nueva colecciÃ³n:");
  if (n) {
    carpetas.push({ nombre: n, links: [] });
    guardarYRenderizar();
  }
}

function eliminarCarpeta(i) {
  if (confirm("Â¿Eliminar carpeta definitivamente?")) {
    carpetas.splice(i, 1);
    guardarYRenderizar();
  }
}

function agregarEnlace(i) {
  const l = prompt("Pega la URL del enlace:");
  if (l) {
    carpetas[i].links.push(l.startsWith('http') ? l : `https://${l}`);
    guardarYRenderizar();
  }
}

function eliminarEnlace(fi, li) {
  carpetas[fi].links.splice(li, 1);
  guardarYRenderizar();
}

function filtrarLinks(input, folderIndex) {
  const filtro = input.value.toLowerCase();
  const listaLinks = document.getElementById(`links-container-${folderIndex}`);
  const items = listaLinks.getElementsByClassName('link-wrapper');

  Array.from(items).forEach(item => {
    const texto = item.getAttribute('data-url').toLowerCase();
    item.style.display = texto.includes(filtro) ? 'flex' : 'none';
  });
}

/* ================= COMPARTIR ================= */
function abrirCompartir(index) {
  const carpeta = carpetas[index];
  const nickname = localStorage.getItem('userNickname') || 'Un usuario';

  textoCompartir =
    `El usuario ${nickname} compartiÃ³ Ã©sta carpeta de enlaces usando LinkApp\n\n` +
    `ðŸ“ Carpeta: ${carpeta.nombre}\n` +
    `---------------------------\n` +
    carpeta.links.map((l, i) => `${i + 1}. ${l}`).join('\n');

  document.getElementById("shareModal").classList.remove("hidden");
}

function cerrarShare() {
  document.getElementById("shareModal").classList.add("hidden");
}

function shareWhatsApp() {
  window.open(`https://wa.me/?text=${encodeURIComponent(textoCompartir)}`);
  cerrarShare();
}

function shareFacebook() {
  window.open(`https://www.facebook.com/sharer/sharer.php?quote=${encodeURIComponent(textoCompartir)}`);
  cerrarShare();
}

function shareTelegram() {
  window.open(`https://t.me/share/url?text=${encodeURIComponent(textoCompartir)}`);
  cerrarShare();
}

function copyShare() {
  navigator.clipboard.writeText(textoCompartir);
  alert("Copiado âœ”");
  cerrarShare();
}

/* ================= RENDER ================= */
function renderCarpetas() {
  const grid = document.getElementById('folderGrid');

  if (carpetas.length === 0) {
    grid.innerHTML = `<p class="col-span-full text-center text-muted py-10 border-2 border-dashed border-border rounded-xl">
      No tienes carpetas aÃºn.</p>`;
    return;
  }

  grid.innerHTML = carpetas.map((folder, fIndex) => `
    <div class="feature-card border border-border bg-surface rounded-xl p-5 flex flex-col h-full">
      <div class="flex justify-between items-start mb-4">
        <div>
          <h3 class="text-lg font-bold text-blue">${folder.nombre}</h3>
          <span class="text-[10px] text-muted uppercase tracking-widest">${folder.links.length} enlaces</span>
        </div>
        <div class="flex gap-2">
          <button onclick="abrirCompartir(${fIndex})">ðŸ“¤</button>
          <button onclick="eliminarCarpeta(${fIndex})" class="text-red-500">ðŸ—‘</button>
        </div>
      </div>

      <input type="text" oninput="filtrarLinks(this, ${fIndex})"
        placeholder="Buscar en esta carpeta..."
        class="w-full bg-bg border border-border text-[11px] p-2 rounded mb-3">

      <div id="links-container-${fIndex}" class="space-y-2 mb-4 flex-grow overflow-y-auto max-h-48 pr-1">
        ${folder.links.map((link, lIndex) => `
          <div class="link-wrapper flex justify-between items-center bg-bg/40 p-2 rounded text-xs"
            data-url="${link}">
            <a href="${link}" target="_blank" class="truncate max-w-[85%] text-muted hover:text-white">${link}</a>
            <button onclick="eliminarEnlace(${fIndex}, ${lIndex})" class="text-red-400">âœ•</button>
          </div>
        `).join('')}
      </div>

      <button onclick="agregarEnlace(${fIndex})"
        class="w-full py-2 bg-blue/10 text-blue border border-blue/20 rounded-md font-bold text-xs">
        + AÃ±adir Link
      </button>
    </div>
  `).join('');
}

renderCarpetas();
</script>

</body>
</html>
